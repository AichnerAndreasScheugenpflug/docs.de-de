---
title: 'Vorgehensweise: Verwenden von JoinBlock zum Lesen aus mehreren Quellen'
ms.date: 03/30/2017
ms.technology: dotnet-standard
dev_langs:
- csharp
- vb
helpviewer_keywords:
- Task Parallel Library, dataflows
- TPL dataflow library, joining blocks in
- dataflow blocks, joining in TPL
ms.assetid: e9c1ada4-ac57-4704-87cb-2f5117f8151d
author: rpetrusha
ms.author: ronpet
ms.openlocfilehash: 0031e352fea845ca4831b4df3a67c9cc6b67e876
ms.sourcegitcommit: a36cfc9dbbfc04bd88971f96e8a3f8e283c15d42
ms.translationtype: HT
ms.contentlocale: de-DE
ms.lasthandoff: 01/11/2019
ms.locfileid: "54222284"
---
# <a name="how-to-use-joinblock-to-read-data-from-multiple-sources"></a><span data-ttu-id="37816-102">Vorgehensweise: Verwenden von JoinBlock zum Lesen aus mehreren Quellen</span><span class="sxs-lookup"><span data-stu-id="37816-102">How to: Use JoinBlock to Read Data From Multiple Sources</span></span>
<span data-ttu-id="37816-103">In diesem Dokument erfahren Sie, wie Sie mithilfe der <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>-Klasse einen Vorgang ausführen, wenn Daten aus mehreren Quellen verfügbar sind.</span><span class="sxs-lookup"><span data-stu-id="37816-103">This document explains how to use the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class to perform an operation when data is available from multiple sources.</span></span> <span data-ttu-id="37816-104">Zudem wird der nicht gierige Modus veranschaulicht, durch den mehrere Gruppierungsblöcke eine Datenquelle effizienter gemeinsam verwenden können.</span><span class="sxs-lookup"><span data-stu-id="37816-104">It also demonstrates how to use non-greedy mode to enable multiple join blocks to share a data source more efficiently.</span></span>

[!INCLUDE [tpl-install-instructions](../../../includes/tpl-install-instructions.md)]

## <a name="example"></a><span data-ttu-id="37816-105">Beispiel</span><span class="sxs-lookup"><span data-stu-id="37816-105">Example</span></span>  
 <span data-ttu-id="37816-106">Im folgenden Beispiel werden drei Ressourcentypen (`NetworkResource`, `FileResource` und `MemoryResource`) definiert und Vorgänge ausführt, sobald Ressourcen verfügbar werden.</span><span class="sxs-lookup"><span data-stu-id="37816-106">The following example defines three resource types, `NetworkResource`, `FileResource`, and `MemoryResource`, and performs operations when resources become available.</span></span> <span data-ttu-id="37816-107">Für dieses Bespiel wird ein Paar aus `NetworkResource` und `MemoryResource` benötigt, um den ersten Vorgang auszuführen, und ein Paar aus `FileResource` und `MemoryResource`, um den zweiten Vorgang auszuführen.</span><span class="sxs-lookup"><span data-stu-id="37816-107">This example requires a `NetworkResource` and `MemoryResource` pair in order to perform the first operation and a `FileResource` and `MemoryResource` pair in order to perform the second operation.</span></span> <span data-ttu-id="37816-108">Damit diese Vorgänge ausgeführt werden, wenn alle erforderlichen Ressourcen verfügbar sind, wird in diesem Beispiel die <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>-Klasse verwendet.</span><span class="sxs-lookup"><span data-stu-id="37816-108">To enable these operations to occur when all required resources are available, this example uses the <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> class.</span></span> <span data-ttu-id="37816-109">Wenn ein <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>-Objekt Daten aus allen Ressourcen empfängt, gibt es diese an das Ziel weiter, d.h. in diesem Beispiel an das <xref:System.Threading.Tasks.Dataflow.ActionBlock%601>-Objekt.</span><span class="sxs-lookup"><span data-stu-id="37816-109">When a <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> object receives data from all sources, it propagates that data to its target, which in this example is an <xref:System.Threading.Tasks.Dataflow.ActionBlock%601> object.</span></span> <span data-ttu-id="37816-110">Beide <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>-Objekte lesen aus dem freigegebenen Pool von `MemoryResource`-Objekten.</span><span class="sxs-lookup"><span data-stu-id="37816-110">Both <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects read from a shared pool of `MemoryResource` objects.</span></span>  
  
 [!code-csharp[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/csharp/VS_Snippets_Misc/tpldataflow_nongreedyjoin/cs/nongreedyjoin.cs#1)]
 [!code-vb[TPLDataflow_NonGreedyJoin#1](../../../samples/snippets/visualbasic/VS_Snippets_Misc/tpldataflow_nongreedyjoin/vb/nongreedyjoin.vb#1)]  
  
 <span data-ttu-id="37816-111">Für eine effiziente Nutzung des freigegebenen Pools von `MemoryResource`-Objekten wird in diesem Beispiel ein <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions>-Objekt angegeben, für das die <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A>-Eigenschaft auf `False` festgelegt ist. Auf diese Weise werden <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>-Objekte erzeugt, die im nicht gierigen Modus agieren.</span><span class="sxs-lookup"><span data-stu-id="37816-111">To enable efficient use of the shared pool of `MemoryResource` objects, this example specifies a <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions> object that has the <xref:System.Threading.Tasks.Dataflow.GroupingDataflowBlockOptions.Greedy%2A> property set to `False` to create <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects that act in non-greedy mode.</span></span> <span data-ttu-id="37816-112">Ein nicht gieriger Gruppierungsblock stellt alle eingehenden Nachrichten zurück, bis eine aus jeder Quelle verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="37816-112">A non-greedy join block postpones all incoming messages until one is available from each source.</span></span> <span data-ttu-id="37816-113">Wenn eine der zurückgestellten Nachrichten durch einen anderen Block akzeptiert wurde, wird der Prozess durch den Gruppierungsblock neu gestartet.</span><span class="sxs-lookup"><span data-stu-id="37816-113">If any of the postponed messages were accepted by another block, the join block restarts the process.</span></span> <span data-ttu-id="37816-114">Der nicht gierige Modus bietet die Möglichkeit, dass Gruppierungsblöcke, die mindestens einen Quellblock gemeinsam nutzen, weiter abgearbeitet werden, während andere Blöcke auf Daten warten.</span><span class="sxs-lookup"><span data-stu-id="37816-114">Non-greedy mode enables join blocks that share one or more source blocks to make forward progress as the other blocks wait for data.</span></span> <span data-ttu-id="37816-115">Wenn in diesem Beispiel ein `MemoryResource`-Objekt zum `memoryResources`-Pool hinzugefügt wird, kann der erste Gruppierungsblock zum Empfangen der zweiten Datenquelle weiter ausgeführt werden.</span><span class="sxs-lookup"><span data-stu-id="37816-115">In this example, if a `MemoryResource` object is added to the `memoryResources` pool, the first join block to receive its second data source can make forward progress.</span></span> <span data-ttu-id="37816-116">Wenn in diesem Beispiel der gierige Modus (also der Standardmodus) verwendet wird, könnte ein Gruppierungsblock das `MemoryResource`-Objekt akzeptieren und warten, bis die zweite Ressource verfügbar ist.</span><span class="sxs-lookup"><span data-stu-id="37816-116">If this example were to use greedy mode, which is the default, one join block might take the `MemoryResource` object and wait for the second resource to become available.</span></span> <span data-ttu-id="37816-117">Wenn der andere Gruppierungsblock jedoch seine zweite Datenquelle zur Verfügung hat, kann er keinen Fortschritt machen, da das `MemoryResource`-Objekt vom anderen Gruppierungsblock akzeptiert wurde.</span><span class="sxs-lookup"><span data-stu-id="37816-117">However, if the other join block has its second data source available, it cannot make forward progress because the `MemoryResource` object has been taken by the other join block.</span></span>  
  
## <a name="compiling-the-code"></a><span data-ttu-id="37816-118">Kompilieren des Codes</span><span class="sxs-lookup"><span data-stu-id="37816-118">Compiling the Code</span></span>  
 <span data-ttu-id="37816-119">Kopieren Sie den Beispielcode, und fügen Sie ihn in ein Visual Studio-Projekt ein, oder fügen Sie ihn in eine Datei namens `DataflowNonGreedyJoin.cs` ein (`DataflowNonGreedyJoin.vb` für Visual Basic), und führen Sie dann den folgenden Befehl in einer Developer-Eingabeaufforderung für Visual Studio aus.</span><span class="sxs-lookup"><span data-stu-id="37816-119">Copy the example code and paste it in a Visual Studio project, or paste it in a file that is named `DataflowNonGreedyJoin.cs` (`DataflowNonGreedyJoin.vb` for Visual Basic), and then run the following command in a Developer Command Prompt for Visual Studio window.</span></span>  
  
 <span data-ttu-id="37816-120">Visual C#</span><span class="sxs-lookup"><span data-stu-id="37816-120">Visual C#</span></span>  
  
 <span data-ttu-id="37816-121">**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**</span><span class="sxs-lookup"><span data-stu-id="37816-121">**csc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.cs**</span></span>  
  
 <span data-ttu-id="37816-122">Visual Basic</span><span class="sxs-lookup"><span data-stu-id="37816-122">Visual Basic</span></span>  
  
 <span data-ttu-id="37816-123">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**</span><span class="sxs-lookup"><span data-stu-id="37816-123">**vbc.exe /r:System.Threading.Tasks.Dataflow.dll DataflowNonGreedyJoin.vb**</span></span>  
  
## <a name="robust-programming"></a><span data-ttu-id="37816-124">Stabile Programmierung</span><span class="sxs-lookup"><span data-stu-id="37816-124">Robust Programming</span></span>  
 <span data-ttu-id="37816-125">Die Verwendung von nicht gierigen Gruppierungen kann Ihnen auch dabei helfen, einen Deadlock in Ihrer Anwendung zu vermeiden.</span><span class="sxs-lookup"><span data-stu-id="37816-125">The use of non-greedy joins can also help you prevent deadlock in your application.</span></span> <span data-ttu-id="37816-126">In einer Softwareanwendung kommt es zu einem *Deadlock*, wenn zwei oder mehr Prozesse jeweils eine Ressource halten und gegenseitig darauf warten, dass ein anderer Prozess eine andere Ressource freigibt.</span><span class="sxs-lookup"><span data-stu-id="37816-126">In a software application, *deadlock* occurs when two or more processes each hold a resource and mutually wait for another process to release some other resource.</span></span> <span data-ttu-id="37816-127">Betrachten Sie eine Anwendung, die zwei <xref:System.Threading.Tasks.Dataflow.JoinBlock%602>-Objekte definiert.</span><span class="sxs-lookup"><span data-stu-id="37816-127">Consider an application that defines two <xref:System.Threading.Tasks.Dataflow.JoinBlock%602> objects.</span></span> <span data-ttu-id="37816-128">Beide Objekte lesen jeweils Daten aus zwei gemeinsam genutzten Quellblöcken.</span><span class="sxs-lookup"><span data-stu-id="37816-128">Both objects each read data from two shared source blocks.</span></span> <span data-ttu-id="37816-129">Wenn ein Gruppierungsblock im gierigen Modus aus der ersten Quelle und der zweite Gruppierungsblock aus der zweiten Quelle liest, könnte die Anwendung blockieren, weil beide Gruppierungsblöcke gegenseitig darauf warten, dass der andere seine Ressource freigibt.</span><span class="sxs-lookup"><span data-stu-id="37816-129">In greedy mode, if one join block reads from the first source and the second join block reads from the second source, the application might deadlock because both join blocks mutually wait for the other to release its resource.</span></span> <span data-ttu-id="37816-130">Im nicht gierigen Modus liest jeder Gruppierungsblock nur dann aus seinen Quellen, wenn alle Daten verfügbar sind und somit das Risiko eines Deadlocks ausgeschlossen ist.</span><span class="sxs-lookup"><span data-stu-id="37816-130">In non-greedy mode, each join block reads from its sources only when all data is available, and therefore, the risk of deadlock is eliminated.</span></span>  
  
## <a name="see-also"></a><span data-ttu-id="37816-131">Siehe auch</span><span class="sxs-lookup"><span data-stu-id="37816-131">See also</span></span>

- [<span data-ttu-id="37816-132">Dataflow (Datenfluss)</span><span class="sxs-lookup"><span data-stu-id="37816-132">Dataflow</span></span>](../../../docs/standard/parallel-programming/dataflow-task-parallel-library.md)
